<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pixel 7 Flashlight Control</title>
<style>
  body { font-family:sans-serif; text-align:center; margin-top:3em; }
  input, button { font-size:1.2em; margin:0.5em; }
</style>
</head>
<body>
  <h2>Pixel 7 Flashlight Control</h2>
  <button id="toggle">Toggle Torch</button><br>
  <label>Brightness:
    <input type="range" id="brightness" min="0" max="1" step="0.05" value="1">
  </label><br>
  <label>Pulse every (ms):
    <input type="number" id="interval" value="500" min="100">
  </label>
  <button id="pulse">Start Pulse</button>
  <button id="stop">Stop</button>

<script>
let stream, track, pulser, torchOn = false;

async function initCamera() {
  if (!stream) {
    stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "environment" }
    });
    track = stream.getVideoTracks()[0];
  }
  return track;
}

async function setTorch(on, level=1) {
  const t = await initCamera();
  const caps = t.getCapabilities();
  if (!caps.torch) {
    alert("Torch not supported on this browser/device.");
    return;
  }

  const constraints = { advanced: [{ torch: on }] };
  if ('torchLevel' in caps) {
    constraints.advanced[0].torchLevel = Math.min(Math.max(level,0),1);
  }

  try {
    await t.applyConstraints(constraints);
    torchOn = on;
  } catch (err) {
    console.error(err);
  }
}

document.getElementById('toggle').onclick = () => setTorch(!torchOn, +brightness.value);
document.getElementById('brightness').oninput = () => {
  if (torchOn) setTorch(true, +brightness.value);
};

document.getElementById('pulse').onclick = () => {
  const interval = +document.getElementById('interval').value;
  clearInterval(pulser);
  pulser = setInterval(async () => {
    torchOn = !torchOn;
    await setTorch(torchOn, +brightness.value);
  }, interval);
};

document.getElementById('stop').onclick = () => {
  clearInterval(pulser);
  setTorch(false);
};

window.onbeforeunload = () => {
  clearInterval(pulser);
  if (track) track.stop();
};
</script>
</body>
</html>
